<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>審査結果 - 求人原稿AIエージェント</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>審査結果</h1>
        <p style="text-align: center; margin-bottom: 20px;"><a href="{{ url_for('index') }}">別のURLを審査する</a></p>

        {% if results %}
            <div class="result-section">
                <h2>処理対象URL</h2>
                <p><a href="{{ results.job_post_url }}" target="_blank" rel="noopener noreferrer">{{ results.job_post_url }}</a></p>
                <p><strong>検知されたドメイン:</strong> {{ results.site_domain | default('N/A', true) }}</p>
            </div>

            {% if results.error_message %}
                <div class="result-section error">
                    <h2>処理エラー</h2>
                    <p>{{ results.error_message }}</p>
                </div>
            {% endif %}

            <div class="result-section">
                <h2>抽出された情報</h2>
                <div class="info-item">
                    <p><strong>職種:</strong></p>
                    <pre>{{ results.job_title | default('N/A', true) }}</pre>
                </div>
                <div class="info-item">
                    <p><strong>給与:</strong></p>
                    <pre>{{ results.salary | default('N/A', true) }}</pre>
                </div>
                <div class="info-item">
                    <p><strong>勤務地:</strong></p>
                    <pre>{{ results.location | default('N/A', true) }}</pre>
                </div>
                <div class="info-item">
                    <p><strong>応募資格:</strong></p>
                    <pre>{{ results.qualifications | default('N/A', true) }}</pre>
                </div>
                <div class="info-item">
                    <p><strong>全文テキスト (抜粋):</strong></p>
                    <pre>{{ (results.full_text_content[:500] + '...' if results.full_text_content and results.full_text_content|length > 500 else results.full_text_content) | default('N/A', true) }}</pre>
                </div>
                <p><strong>画像から抽出されたテキスト(OCR)数:</strong> {{ results.image_ocr_texts | length }}</p>
            </div>

            <div class="result-section">
                <h2>AI審査結果</h2>
                {# Use the new HTML formatted review result, ensuring Flask/Jinja2 renders it as HTML #}
                <div class="review-output-formatted">
                    {{ results.review_result | default('<p>審査結果なし</p>', true) | safe }}
                </div>
            </div>

            {% if results.debug_messages and results.debug_messages|length > 0 %}
            <!-- デバッグ情報は開発時のみ表示するか、別途詳細ページなどを検討 -->
            <!--
            <div class="result-section">
                <h2>デバッグ情報</h2>
                <p><strong>ルールブックのチャンク数:</strong> {{ results.rulebook_chunks_count }}</p>
                <p><strong>詳細ログ (core_logic):</strong></p>
                <pre>
                {% for msg in results.debug_messages %}
                {{ msg }}
                {% endfor %}
                </pre>
            </div>
            -->
            {% endif %}

        {% else %}
            <p>結果がありません。</p>
        {% endif %}
        <p style="text-align: center; margin-top: 30px;"><a href="{{ url_for('index') }}">別のURLを審査する</a></p>
    </div>
</body>
</html>
